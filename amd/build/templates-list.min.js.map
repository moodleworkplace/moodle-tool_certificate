{"version":3,"file":"templates-list.min.js","sources":["../src/templates-list.js"],"sourcesContent":["// This file is part of the tool_certificate plugin for Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module used when viewing the list of templates\n *\n * @module     tool_certificate/templates-list\n * @copyright  2019 Marina Glancy\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'tool_certificate/modal_form', 'core/notification', 'core/str', 'core/ajax', 'core/toast'],\nfunction($, ModalForm, Notification, Str, Ajax, Toast) {\n\n    /**\n     * Display modal form\n     *\n     * @param {jQuery} triggerElement\n     * @param {String} title\n     * @param {Object} args\n     * @return {ModalForm}\n     */\n    var displayModal = function(triggerElement, title, args) {\n        var modal = new ModalForm({\n            formClass: 'tool_certificate\\\\form\\\\details',\n            args: args,\n            modalConfig: {title: title},\n            saveButtonText: Str.get_string('save'),\n            triggerElement: triggerElement,\n        });\n        return modal;\n    };\n\n    /**\n     * Add template dialogue\n     * @param {Event} e\n     */\n    var displayAddTemplate = function(e) {\n        var contextid = $(e.currentTarget).data('contextid');\n        e.preventDefault();\n        var modal = displayModal($(e.currentTarget), Str.get_string('createtemplate', 'tool_certificate'),\n            {id: 0, contextid: contextid});\n        modal.onSubmitSuccess = function(url) {\n            window.location.href = url;\n        };\n    };\n\n    /**\n     * Edit template dialogue\n     * @param {Event} e\n     */\n    var displayEditTemplate = function(e) {\n        e.preventDefault();\n        var el = $(e.currentTarget),\n            id = el.attr('data-id'),\n            name = el.attr('data-name');\n        var modal = displayModal(el, Str.get_string('editcertificate', 'tool_certificate', name), {id: id});\n        modal.onSubmitSuccess = function() {\n            window.location.reload();\n        };\n    };\n\n    /**\n     * Add template dialogue\n     * @param {Event} e\n     */\n    var displayIssue = function(e) {\n        e.preventDefault();\n        const target = $(e.currentTarget);\n        var modal = new ModalForm({\n            formClass: 'tool_certificate\\\\form\\\\certificate_issues',\n            args: {tid: target.attr('data-tid')},\n            modalConfig: {title: Str.get_string('issuecertificates', 'tool_certificate'), scrollable: false},\n            saveButtonText: Str.get_string('save'),\n            triggerElement: target,\n        });\n        modal.onSubmitSuccess = function(data) {\n            data = parseInt(data, 10);\n            if (data) {\n                Str.get_strings([\n                    {key: 'oneissuewascreated', component: 'tool_certificate'},\n                    {key: 'aissueswerecreated', component: 'tool_certificate', param: data}\n                ]).done(function(s) {\n                    var str = data > 1 ? s[1] : s[0];\n                    Toast.add(str);\n                });\n            } else {\n                Str.get_string('noissueswerecreated', 'tool_certificate')\n                    .done(function(s) {\n                        Toast.add(s);\n                    });\n            }\n        };\n    };\n\n    var duplicateMulticategory = function(e) {\n        e.preventDefault();\n        const target = $(e.currentTarget);\n        const templateId = target.attr('data-id');\n        var modal = new ModalForm({\n            formClass: 'tool_certificate\\\\form\\\\category_selector',\n            args: {id: templateId},\n            modalConfig: {title: Str.get_string('confirm')},\n            saveButtonText: Str.get_string('duplicate', 'tool_certificate'),\n            triggerElement: target,\n        });\n        modal.onSubmitSuccess = function() {\n            window.location.reload();\n        };\n    };\n\n    var duplicateSinglecategory = function(e) {\n        e.preventDefault();\n        const templateId = $(e.currentTarget).attr('data-id');\n        Str.get_strings([\n            {key: 'confirm', component: 'moodle'},\n            {key: 'duplicatetemplateconfirm', component: 'tool_certificate', param: $(e.currentTarget).attr('data-name')},\n            {key: 'duplicate', component: 'tool_certificate'},\n            {key: 'cancel', component: 'moodle'}\n        ]).done(function(s) {\n            Notification.confirm(s[0], s[1], s[2], s[3], function() {\n                var promises = Ajax.call([\n                    {methodname: 'tool_certificate_duplicate_template',\n                        args: {id: templateId}}\n                ]);\n                promises[0].done(function() {\n                    window.location.reload();\n                }).fail(Notification.exception);\n            });\n        }).fail(Notification.exception);\n    };\n\n    var deleteTemplate = function(e) {\n        e.preventDefault();\n        const templateId = $(e.currentTarget).attr('data-id');\n        Str.get_strings([\n            {key: 'confirm', component: 'moodle'},\n            {key: 'deletetemplateconfirm', component: 'tool_certificate', param: $(e.currentTarget).attr('data-name')},\n            {key: 'delete', component: 'moodle'},\n            {key: 'cancel', component: 'moodle'}\n        ]).done(function(s) {\n            Notification.confirm(s[0], s[1], s[2], s[3], function() {\n                var promises = Ajax.call([\n                    {methodname: 'tool_certificate_delete_template',\n                        args: {id: templateId}}\n                ]);\n                promises[0].done(function() {\n                    window.location.reload();\n                }).fail(Notification.exception);\n            });\n        }).fail(Notification.exception);\n    };\n\n    return {\n        /**\n         * Init page\n         */\n        init: function() {\n            // Add button is not inside a tab, so we can't use Tab.addButtonOnClick .\n            $('body')\n                .on('click', '[data-element=\"addbutton\"]', displayAddTemplate)\n                .on('click', '[data-action=\"editdetails\"]', displayEditTemplate)\n                .on('click', '[data-action=\"issue\"]', displayIssue)\n                .on('click', '[data-action=\"duplicate\"][data-selectcategory=\"1\"]', duplicateMulticategory)\n                .on('click', '[data-action=\"duplicate\"][data-selectcategory=\"0\"]', duplicateSinglecategory)\n                .on('click', '[data-action=\"delete\"]', deleteTemplate);\n        }\n    };\n});\n\n"],"names":["define","$","ModalForm","Notification","Str","Ajax","Toast","displayModal","triggerElement","title","args","formClass","modalConfig","saveButtonText","get_string","displayAddTemplate","e","contextid","currentTarget","data","preventDefault","id","onSubmitSuccess","url","window","location","href","displayEditTemplate","el","attr","name","reload","displayIssue","target","tid","scrollable","parseInt","get_strings","key","component","param","done","s","str","add","duplicateMulticategory","templateId","duplicateSinglecategory","confirm","call","methodname","fail","exception","deleteTemplate","init","on"],"mappings":"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"}