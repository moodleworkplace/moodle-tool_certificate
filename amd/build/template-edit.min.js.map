{"version":3,"sources":["../src/template-edit.js"],"names":["define","$","jqui","ModalForm","Notification","Str","Ajax","SortableList","editReportDetailsHandler","e","preventDefault","el","currentTarget","id","attr","name","modal","formClass","args","modalConfig","title","get_string","saveButtonText","triggerElement","onSubmitSuccess","window","location","reload","deleteElement","get_strings","key","component","param","done","s","confirm","promises","call","methodname","fail","exception","editElement","hasClass","addElement","pageid","type","element","text","deletePage","href","addPage","templateid","editPage","initSorting","each","sortablelist","find","getElementName","Deferred","resolve","on","EVENTS","DROP","_","info","positionChanged","request","data","sequence","index","mmToPx","value","parseFloat","pxToMm","Math","round","ptToPx","recalculatePDF","page","css","left","refpoint","parseInt","offset","width","addClass","draggable","initDraggable","closest","snap","shiftKey","snapMode","snapTolerance","containment","top","height","setTimeout","removeClass","posx","posy","init"],"mappings":"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","sourcesContent":["// This file is part of the tool_certificate plugin for Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module used when editing a single template\n *\n * @module     tool_certificate/template-edit\n * @package    tool_certificate\n * @copyright  2019 Marina Glancy\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'jqueryui', 'tool_certificate/modal_form', 'core/notification', 'core/str', 'core/ajax', 'core/sortable_list'],\nfunction($, jqui, ModalForm, Notification, Str, Ajax, SortableList) {\n    var editReportDetailsHandler = function(e) {\n        e.preventDefault();\n        var el = $(e.currentTarget),\n            id = el.attr('data-id'),\n            name = el.attr('data-name');\n\n        var modal = new ModalForm({\n            formClass: 'tool_certificate\\\\form\\\\details',\n            args: {id: id},\n            modalConfig: {title: Str.get_string('editcertificate', 'tool_certificate', name)},\n            saveButtonText: Str.get_string('save'),\n            triggerElement: el,\n        });\n        modal.onSubmitSuccess = function() {\n            window.location.reload();\n        };\n    };\n\n    var deleteElement = function(e) {\n        e.preventDefault();\n        Str.get_strings([\n            {key: 'confirm', component: 'moodle'},\n            {key: 'deleteelementconfirm', component: 'tool_certificate', param: $(e.currentTarget).attr('data-name')},\n            {key: 'delete', component: 'moodle'},\n            {key: 'cancel', component: 'moodle'}\n        ]).done(function(s) {\n            Notification.confirm(s[0], s[1], s[2], s[3], function() {\n                var promises = Ajax.call([\n                    {methodname: 'tool_certificate_delete_element',\n                        args: {id: $(e.currentTarget).attr('data-id')}}\n                ]);\n                promises[0].done(function() {\n                    // TODO reload only list of elements.\n                    window.location.reload();\n                }).fail(Notification.exception);\n            });\n        }).fail(Notification.exception);\n    };\n\n    var editElement = function(e) {\n        e.preventDefault();\n        if ($(e.currentTarget).hasClass('isdragged')) {\n            return;\n        }\n        var modal = new ModalForm({\n            formClass: 'tool_certificate\\\\edit_element_form',\n            args: {id: $(e.currentTarget).attr('data-id')},\n            modalConfig: {title: Str.get_string('editelement', 'tool_certificate', $(e.currentTarget).attr('data-name'))},\n            saveButtonText: Str.get_string('save'),\n            triggerElement: $(e.currentTarget),\n        });\n        modal.onSubmitSuccess = function() {\n            window.location.reload();\n        };\n    };\n\n    var addElement = function(e) {\n        e.preventDefault();\n        var pageid = $(e.currentTarget).attr('data-pageid'),\n            type = $(e.currentTarget).attr('data-element');\n        var modal = new ModalForm({\n            formClass: 'tool_certificate\\\\edit_element_form',\n            args: {pageid: pageid, element: type},\n            modalConfig: {title: Str.get_string('addelementwithname', 'tool_certificate', $(e.currentTarget).text())},\n            saveButtonText: Str.get_string('save'),\n            triggerElement: $(e.currentTarget),\n        });\n        modal.onSubmitSuccess = function() {\n            window.location.reload();\n        };\n    };\n\n    var deletePage = function(e) {\n        e.preventDefault();\n        Str.get_strings([\n            {key: 'confirm', component: 'moodle'},\n            {key: 'deletepageconfirm', component: 'tool_certificate'},\n            {key: 'delete', component: 'moodle'},\n            {key: 'cancel', component: 'moodle'}\n        ]).done(function(s) {\n            Notification.confirm(s[0], s[1], s[2], s[3], function() {\n                window.location.href = $(e.currentTarget).attr('href');\n            });\n        }).fail(Notification.exception);\n    };\n\n    var addPage = function(e) {\n        e.preventDefault();\n        var modal = new ModalForm({\n            formClass: 'tool_certificate\\\\form\\\\page',\n            args: {templateid: $('[data-region=\"template\"][data-id]').attr('data-id')},\n            modalConfig: {title: Str.get_string('addcertpage', 'tool_certificate')},\n            saveButtonText: Str.get_string('save'),\n            triggerElement: $(e.currentTarget),\n        });\n        modal.onSubmitSuccess = function() {\n            window.location.reload();\n        };\n    };\n\n    var editPage = function(e) {\n        e.preventDefault();\n        var modal = new ModalForm({\n            formClass: 'tool_certificate\\\\form\\\\page',\n            args: {id: $(e.currentTarget).attr('data-id')},\n            modalConfig: {title: Str.get_string('editpage', 'tool_certificate', $(e.currentTarget).attr('data-pagenumber'))},\n            saveButtonText: Str.get_string('save'),\n            triggerElement: $(e.currentTarget),\n        });\n        modal.onSubmitSuccess = function() {\n            window.location.reload();\n        };\n    };\n\n    var initSorting = function() {\n        $('[data-region=\"page\"]').each(function() {\n            var sortablelist = new SortableList($(this).find('[data-region=\"elementlist\"]'));\n            sortablelist.getElementName = function(element) {\n                return $.Deferred().resolve(element.find('a.quickeditlink').text());\n            };\n            $(this).on(SortableList.EVENTS.DROP, '[data-region=\"elementlist\"] > *', function(_, info) {\n                if (info.positionChanged) {\n                    var request = {\n                        methodname: 'tool_certificate_update_element',\n                        args: {id: info.element.data('id'), sequence: info.element.index() + 1}\n                    };\n                    Ajax.call([request])[0].fail(Notification.exception);\n                }\n            });\n        });\n    };\n\n    var mmToPx = function(value) {\n        // TODO replace 2 with a ratio.\n        return parseFloat(value) * 2;\n    };\n\n    var pxToMm = function(value) {\n        // TODO replace 2 with a ratio.\n        return Math.round(parseFloat(value) / 2);\n    };\n\n    var ptToPx = function(value) {\n        // 1pt = 1/72 inch = 0.352778 mm .\n        return mmToPx(value) * 0.352778;\n    };\n\n    var recalculatePDF = function() {\n        var page = $(this);\n        page.css(\"width\", mmToPx(page.data('pagewidth')) + 'px');\n        page.css(\"height\", mmToPx(page.data('pageheight')) + 'px');\n        page.find('[data-width]').each(function() {\n            $(this).css('width', mmToPx($(this).data('width')) + 'px');\n        });\n        page.find('[data-height]').each(function() {\n            $(this).css('height', mmToPx($(this).data('height')) + 'px');\n        });\n        page.find('[data-fontsize]').each(function() {\n            $(this).css('font-size', ptToPx($(this).data('fontsize')) + 'px');\n        });\n        page.find('[data-posy]').each(function() {\n            $(this).css('top', mmToPx($(this).data('posy')) + 'px');\n        });\n        page.find('[data-posx]').each(function() {\n            // For elements with a refpoint calculate the posx of the top left corner.\n            // Refpoint=0 - no change, =1 - move left by half of the width, =2 - move left by the width.\n            var left = mmToPx($(this).data('posx')),\n                refpoint = $(this).data('refpoint') ? parseInt($(this).data('refpoint')) : 0,\n                offset = refpoint ? parseInt($(this).width()) * refpoint / 2 : 0;\n            $(this).css(\"left\", (left - offset) + 'px');\n        });\n        page.addClass('recalculated');\n        // Init draggable.\n        page.find('[data-drag-type=\"move\"]').draggable();\n    };\n\n    var initDraggable = function() {\n        var selector = '[data-region=\"pdf\"] [data-drag-type=\"move\"]';\n        $('body')\n            .on('mousedown', selector, function(e) {\n                var el = $(e.currentTarget),\n                    page = el.closest('[data-region=\"pdf\"]');\n                // Set element \"pagecenter\" to be the same width as this element and place it in the page center.\n                page.find('[data-region=\"pagecenter\"]')\n                    .css(\"left\", (mmToPx(page.data('pagecentre')) - el.width() / 2) + \"px\")\n                    .css(\"width\", el.width() + \"px\");\n                el.draggable({\n                    // Snap to elements only if Shift is not held.\n                    snap: e.shiftKey ? false : '.snapdraggable',\n                    snapMode: 'inner',\n                    snapTolerance: 10,\n                    // Set containment so it can't be moved far away from the page outlines.\n                    containment: [\n                        page.offset().left - el.width(),\n                        page.offset().top - el.height(),\n\n                        page.offset().left + mmToPx(page.data('pagewidth')),\n                        page.offset().top + mmToPx(page.data('pageheight'))\n                    ],\n                });\n            })\n            .on('dragstart', selector, function(e) {\n                $(e.currentTarget).addClass('isdragged');\n            })\n            .on('dragstop', selector, function(e) {\n                var el = $(e.currentTarget),\n                    page = el.closest('[data-region=\"pdf\"]'),\n                    refpoint = parseInt($(this).data('refpoint')),\n                    offset = refpoint ? parseInt($(this).width()) * refpoint / 2 : 0,\n                    left = pxToMm(el.offset().left - page.offset().left + offset),\n                    top = pxToMm(el.offset().top - page.offset().top);\n                setTimeout(function() {\n                    el.removeClass('isdragged');\n                }, 100);\n                var request = {\n                    methodname: 'tool_certificate_update_element',\n                    args: {id: el.data('id'), posx: left, posy: top}\n                };\n                Ajax.call([request])[0].fail(Notification.exception);\n            });\n    };\n\n    return {\n        init: function() {\n            // Add button is not inside a tab, so we can't use Tab.addButtonOnClick .\n            $('[data-action=\"editdetails\"]').on('click', editReportDetailsHandler);\n            $('[data-action=\"deleteelement\"]').on('click', deleteElement);\n            $('[data-action=\"editelement\"]').on('click', editElement);\n            $('[data-action=\"addelement\"]').on('click', addElement);\n            $('[data-action=\"deletepage\"]').on('click', deletePage);\n            $('[data-element=\"addbutton\"]').on('click', addPage);\n            $('[data-action=\"editpage\"]').on('click', editPage);\n            initSorting();\n            initDraggable();\n            $('[data-region=\"pdf\"]').each(recalculatePDF);\n        }\n    };\n});\n"],"file":"template-edit.min.js"}